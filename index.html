<!DOCTYPE html>
<html>
<head>
    <title>海流模拟器</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #map { height: 500px; margin-top: 20px; border: 1px solid #ddd; }
        button { padding: 10px 15px; background: #4285f4; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>海流轨迹模拟</h1>
    <div>
        <label>经度: <input type="number" id="lon" value="121.5" step="0.1"></label>
        <label>纬度: <input type="number" id="lat" value="25.0" step="0.1"></label>
        <label>时长(小时): <input type="number" id="duration" value="12" min="1"></label>
        <button onclick="runSimulation()">开始模拟</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // 初始化地图（台湾周边）
        const map = L.map('map').setView([25.0, 121.5], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // 运行模拟
        async function runSimulation() {
            const lon = parseFloat(document.getElementById('lon').value);
            const lat = parseFloat(document.getElementById('lat').value);
            const duration = parseFloat(document.getElementById('duration').value);

            try {
                const response = await fetch('https://opendrift-api-1087471739366.asia-east1.run.app/simulate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lon, lat, duration })
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    drawTrajectory(data.trajectory);
                } else {
                    alert('模拟失败: ' + data.message);
                }
            } catch (err) {
                alert('请求错误: ' + err.message);
            }
        }

        // 在地图上绘制轨迹
        function drawTrajectory(trajectory) {
            // 清除旧轨迹
            map.eachLayer(layer => {
                if (layer instanceof L.Polyline) map.removeLayer(layer);
            });

            // 绘制新轨迹
            const points = trajectory.map(p => [p.lat, p.lon]);
            L.polyline(points, { color: 'red' }).addTo(map);
            
            // 自动缩放地图到轨迹范围
            map.fitBounds(points);
        }
    </script>
</body>
</html>
